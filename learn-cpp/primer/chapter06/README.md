# C++ Primer Chapter06

## 函数基础

一个典型的函数（function）定义包括以下部分：返回类型（return type）、函数名字、由0个或多个形参（parameter）组成的列表以及函数体。其中，形参以逗号隔开，形参的列表位于一对圆括号之内。函数执行的操作在语句块中说明，该语句块称为函数体（function body）。

- 函数调用完成两项工作：一是用实参初始化函数对应的形参，二是将控制权转移给被调用函数。
- return语句的两项工作：一是返回return语句中的值，二是将控制权从被调函数转移回主调函数。

### 局部对象

- 名字的作用域是程序文本的一部分，名字在其中可见
- 对象的生命周期是程序执行过程中该对象存在的一段时间

局部静态对象在程序的执行路径第一次经过对象定义语句时初始化，并且直到程序终止才被销毁。

### 函数声明

函数的声明和函数的定义非常类似，唯一的区别是函数声明无须函数体，用一个分号替代即可。

### 分离式编译

## 参数传递

- 引用传递：形参是引用类型时
- 值传递：实参的值被拷贝给形参时

### 传值参数

### 传引用参数

通过使用引用形参，允许函数改变一个或多个实参的值

使用引用避免拷贝  
拷贝大的类类型对象或者容器对象比较低效，甚至有的类类型（包括IO类型在内）根本就不支持拷贝操作。当某种类型不支持拷贝操作时，函数只能通过引用形参访问该类型的对象。

使用引用形参返回额外信息  
一个函数只能返回一个值，然而有时函数需要同时返回多个值，引用形参为我们一次返回多个结果提供了有效的途径。

```c++
// 返回s中c第一次出现的位置索引
// 引用形参occurs负责统计c出现的总次数

string::size_type find_char(const string &s, char c, string::size_type &occurs)
{
    auto ret = s.zize();
    occurs = 0;
    for(decltype(ret) i=0;i != s.size(); ++i)
    {
        if (s[i] == c) 
        {
            if (ret == s.size())
            {
                ret = i;
            }
            ++occurs;
        }
    }
    return ret;
}
auto index = find_char(s, 'c', ctr);
```

### const形参和实参

实参初始化形参时会忽略掉顶层const。

尽量使用常量引用  
把函数不会改变的形参定义成（普通的）引用是一种比较常见的错误，这么做带给函数的调用者一种误导，即函数可以修改它的实参的值。此外，使用引用而非常量引用也会极大地限制函数所能接受的实参类型。就像刚刚看到的，我们不能把const对象、字面值或者需要类型转换的对象传递给普通的引用形参。

### 数组形参

- 不允许拷贝数组
- 使用数组时（通常）会将其转换成指针

为了保证数组不会越界

- 使用标记指定数组长度
- 使用标准库规范
- 显式传递一个表示数组大小的形参

### main：处理命令行选项

1. 用户通过设置一组选项来确定函数所要执行的操作`prog -d -o ofile data0`
2. 通过两个可选的形参传递给main函数`int main(int argc, char *argv[]) {}`

### 含有可变形参的函数

如果所有的实参类型相同，可以传递一个名为initializer_list的标准库类型；如果实参的类型不同，我们可以编写一种特殊的函数，也就是所谓的可变参数模板
